"use strict";function parseQueryString(o){var t={};return o.split("&").forEach(function(o){var i=o.split("="),n=i[0],e=decodeURIComponent(i[1]);n in t?t[n].push(e):t[n]=[e]}),t}function handleNotificationClick(o){_roostSW.logging&&console.log("Notification clicked: ",o.notification),o.notification.close();var t=o.notification.icon;if(t.indexOf("?")>-1){var i=t.split("?")[1],n=parseQueryString(i);if(n.url&&1==n.url.length)return _roostSW.logging&&console.log("Opening URL: "+n.url[0]),clients.openWindow(n.url[0])}console.log("Failed to redirect to notification for iconURL: "+t)}function showNotification(o,t,i,n){var e={body:i,tag:"roost",icon:_roostSW.host+"/api/browser/logo?size=100&direct=true&appKey="+_roostSW.appKey+"&noteID="+o+"&url="+encodeURIComponent(n)};return self.registration.showNotification(t,e)}var _roostSW={version:2,logging:!0,appKey:"552diyl7s5ok25t8x5343t6hzd87qc60",host:"https://go.goroost.com"};self.addEventListener("install",function(o){o.waitUntil(self.skipWaiting())}),self.addEventListener("activate",function(){_roostSW.logging&&console.log("Activated Roost ServiceWorker version: "+_roostSW.version)}),self.addEventListener("push",function(o){_roostSW.logging&&console.log("push listener",o),o.waitUntil(self.registration.pushManager.getSubscription().then(function(o){var t=null;return t="subscriptionId"in o?o.subscriptionId:o.endpoint,fetch(_roostSW.host+"/api/browser/notifications?version="+_roostSW.version+"&appKey="+_roostSW.appKey+"&deviceID="+encodeURIComponent(t)).then(function(o){return o.json().then(function(o){_roostSW.logging&&console.log(o);for(var t=[],i=0;o.notifications.length>i;i++){var n=o.notifications[i];_roostSW.logging&&console.log("Showing notification: "+n.body);var e="/roost.html?noteID="+n.roost_note_id+"&sendID="+n.roost_send_id+"&body="+encodeURIComponent(n.body);t.push(showNotification(n.roost_note_id,n.title,n.body,e,_roostSW.appKey))}return Promise.all(t)})})}))}),self.addEventListener("notificationclick",function(o){_roostSW.logging&&console.log("notificationclick listener",o),o.waitUntil(handleNotificationClick(o))});
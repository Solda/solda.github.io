"use strict";function parseQueryString(o){var n={};return o.split("&").forEach(function(o){var t=o.split("="),i=t[0],e=decodeURIComponent(t[1]);i in n?n[i].push(e):n[i]=[e]}),n}function handleNotificationClick(o){_roostSW.logging&&console.log("Notification clicked: ",o.notification),o.notification.close();var n=o.notification.icon;if(n.indexOf("?")>-1){var t=n.split("?")[1],i=parseQueryString(t);if(i.url&&1==i.url.length)return _roostSW.logging&&console.log("Opening URL: "+i.url[0]),clients.openWindow(i.url[0])}console.log("Failed to redirect to notification for iconURL: "+n)}function showNotification(o,n,t,i){var e={body:t,tag:"roost",icon:_roostSW.host+"/api/browser/logo?size=100&direct=true&appKey="+_roostSW.appKey+"&noteID="+o+"&url="+encodeURIComponent(i)};return self.registration.showNotification(n,e)}var _roostSW={version:2,logging:!0,appKey:"pjzx8kv0hn7882woj032dc8cgbl16cg5",host:"https://go.goroost.com"};self.addEventListener("install",function(o){o.waitUntil(self.skipWaiting())}),self.addEventListener("activate",function(){_roostSW.logging&&console.log("Activated Roost ServiceWorker version: "+_roostSW.version)}),self.addEventListener("push",function(o){_roostSW.logging&&console.log("push listener",o),o.waitUntil(self.registration.pushManager.getSubscription().then(function(o){var n=null;return n="subscriptionId"in o?o.subscriptionId:o.endpoint,fetch(_roostSW.host+"/api/browser/notifications?version="+_roostSW.version+"&appKey="+_roostSW.appKey+"&deviceID="+encodeURIComponent(n)).then(function(o){return o.json().then(function(o){_roostSW.logging&&console.log(o);for(var n=[],t=0;o.notifications.length>t;t++){var i=o.notifications[t];_roostSW.logging&&console.log("Showing notification: "+i.body);var e="/roost.html?noteID="+i.roost_note_id+"&sendID="+i.roost_send_id+"&body="+encodeURIComponent(i.body);n.push(showNotification(i.roost_note_id,i.title,i.body,e,_roostSW.appKey))}return Promise.all(n)})})}))}),self.addEventListener("notificationclick",function(o){_roostSW.logging&&console.log("notificationclick listener",o),o.waitUntil(handleNotificationClick(o))});